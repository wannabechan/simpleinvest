name: ì£¼ì‹ ê°€ê²© ë¡œê·¸ ê¸°ë¡

# ì£¼ê¸° ì‹¤í–‰ì€ cron-job.org ì‚¬ìš©. ì—¬ê¸°ì„œëŠ” ìˆ˜ë™ ì‹¤í–‰(ë°±ì—…/í…ŒìŠ¤íŠ¸)ë§Œ ê°€ëŠ¥
on:
  workflow_dispatch:

jobs:
  log-prices:
    runs-on: ubuntu-latest
    steps:
      - name: API í˜¸ì¶œ
        run: |
          if [ -z "$VERCEL_URL" ]; then
            echo "âŒ VERCEL_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
            echo "GitHub ì €ì¥ì†Œ â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret"
            echo "Name: VERCEL_URL"
            echo "Value: https://your-project.vercel.app (ì‹¤ì œ Vercel ë°°í¬ URL)"
            exit 1
          fi
          
          echo "ğŸ“Š ê°€ê²© ë¡œê·¸ ê¸°ë¡ API í˜¸ì¶œ ì‹œì‘"
          echo "URL: $VERCEL_URL/api/cron/log-prices"
          
          if [ -n "$CRON_SECRET" ]; then
            response=$(curl -s -w "\n%{http_code}" -X GET "$VERCEL_URL/api/cron/log-prices" \
              -H "User-Agent: GitHub-Actions" \
              -H "Accept: application/json" \
              -H "Authorization: Bearer $CRON_SECRET" \
              --max-time 60)
          else
            response=$(curl -s -w "\n%{http_code}" -X GET "$VERCEL_URL/api/cron/log-prices" \
              -H "User-Agent: GitHub-Actions" \
              -H "Accept: application/json" \
              --max-time 60)
          fi
          
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          
          echo ""
          echo "=== ì‘ë‹µ ì •ë³´ ==="
          echo "HTTP Status: $http_code"
          echo "Response Body:"
          echo "$body" | head -20
          echo ""
          
          if [ "$http_code" -eq 200 ]; then
            echo "âœ… API í˜¸ì¶œ ì„±ê³µ"
            exit 0
          else
            echo "âŒ API í˜¸ì¶œ ì‹¤íŒ¨ (HTTP $http_code)"
            echo ""
            echo "ê°€ëŠ¥í•œ ì›ì¸:"
            echo "1. VERCEL_URLì´ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ì„¤ì •ë˜ì§€ ì•ŠìŒ"
            echo "2. API ì—”ë“œí¬ì¸íŠ¸ê°€ ë°°í¬ë˜ì§€ ì•ŠìŒ"
            echo "3. ì„œë²„ ì˜¤ë¥˜ ë°œìƒ"
            exit 1
          fi
        env:
          VERCEL_URL: ${{ secrets.VERCEL_URL }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
